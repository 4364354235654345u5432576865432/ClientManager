/**
 * @license RequireJS text 2.0.0 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

define("text",["module"],function(module){var progIds=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],xmlRegExp=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,bodyRegExp=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,hasLocation=typeof location!="undefined"&&location.href,defaultProtocol=hasLocation&&location.protocol&&location.protocol.replace(/\:/,""),defaultHostName=hasLocation&&location.hostname,defaultPort=hasLocation&&(location.port||undefined),buildMap=[],masterConfig=module.config(),text,fs;return text={version:"2.0.0",strip:function(content){if(content){content=content.replace(xmlRegExp,"");var matches=content.match(bodyRegExp);matches&&(content=matches[1])}else content="";return content},jsEscape:function(content){return content.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var xhr,i,progId;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(i=0;i<3;i++){progId=progIds[i];try{xhr=new ActiveXObject(progId)}catch(e){}if(xhr){progIds=[progId];break}}return xhr},parseName:function(name){var strip=!1,index=name.indexOf("."),modName=name.substring(0,index),ext=name.substring(index+1,name.length);return index=ext.indexOf("!"),index!==-1&&(strip=ext.substring(index+1,ext.length),strip=strip==="strip",ext=ext.substring(0,index)),{moduleName:modName,ext:ext,strip:strip}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(url,protocol,hostname,port){var match=text.xdRegExp.exec(url),uProtocol,uHostName,uPort;return match?(uProtocol=match[2],uHostName=match[3],uHostName=uHostName.split(":"),uPort=uHostName[1],uHostName=uHostName[0],(!uProtocol||uProtocol===protocol)&&(!uHostName||uHostName===hostname)&&(!uPort&&!uHostName||uPort===port)):!0},finishLoad:function(name,strip,content,onLoad){content=strip?text.strip(content):content,masterConfig.isBuild&&(buildMap[name]=content),onLoad(content)},load:function(name,req,onLoad,config){if(config.isBuild&&!config.inlineText){onLoad();return}masterConfig.isBuild=config.isBuild;var parsed=text.parseName(name),nonStripName=parsed.moduleName+"."+parsed.ext,url=req.toUrl(nonStripName),useXhr=masterConfig.useXhr||text.useXhr;!hasLocation||useXhr(url,defaultProtocol,defaultHostName,defaultPort)?text.get(url,function(content){text.finishLoad(name,parsed.strip,content,onLoad)},function(err){onLoad.error&&onLoad.error(err)}):req([nonStripName],function(content){text.finishLoad(parsed.moduleName+"."+parsed.ext,parsed.strip,content,onLoad)})},write:function(pluginName,moduleName,write,config){if(buildMap.hasOwnProperty(moduleName)){var content=text.jsEscape(buildMap[moduleName]);write.asModule(pluginName+"!"+moduleName,"define(function () { return '"+content+"';});\n")}},writeFile:function(pluginName,moduleName,req,write,config){var parsed=text.parseName(moduleName),nonStripName=parsed.moduleName+"."+parsed.ext,fileName=req.toUrl(parsed.moduleName+"."+parsed.ext)+".js";text.load(nonStripName,req,function(value){var textWrite=function(contents){return write(fileName,contents)};textWrite.asModule=function(moduleName,contents){return write.asModule(moduleName,fileName,contents)},text.write(pluginName,nonStripName,textWrite,config)},config)}},typeof process!="undefined"&&process.versions&&!!process.versions.node?(fs=require.nodeRequire("fs"),text.get=function(url,callback){var file=fs.readFileSync(url,"utf8");file.indexOf("ï»¿")===0&&(file=file.substring(1)),callback(file)}):text.createXhr()?text.get=function(url,callback,errback){var xhr=text.createXhr();xhr.open("GET",url,!0),masterConfig.onXhr&&masterConfig.onXhr(xhr,url),xhr.onreadystatechange=function(evt){var status,err;xhr.readyState===4&&(status=xhr.status,status>399&&status<600?(err=new Error(url+" HTTP status: "+status),err.xhr=xhr,errback(err)):callback(xhr.responseText))},xhr.send(null)}:typeof Packages!="undefined"&&(text.get=function(url,callback){var encoding="utf-8",file=new java.io.File(url),lineSeparator=java.lang.System.getProperty("line.separator"),input=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file),encoding)),stringBuffer,line,content="";try{stringBuffer=new java.lang.StringBuffer,line=input.readLine(),line&&line.length()&&line.charAt(0)===65279&&(line=line.substring(1)),stringBuffer.append(line);while((line=input.readLine())!==null)stringBuffer.append(lineSeparator),stringBuffer.append(line);content=String(stringBuffer.toString())}finally{input.close()}callback(content)}),text}),define("text!templates/home.html",[],function(){return'<div class="hero-unit">\r\n  <h1>Client Manager</h1>\r\n  <p>This is a sample application built with Backbone, RequireJS, Twitter Bootstrap (frontend) and Node.js, Express.js, Mongoose (backend).</p>\r\n  <p><a class="btn btn-primary btn-large" href="//github.com/alessioalex/ClientManager">Fork me &raquo;</a></p>\r\n</div>\r\n\r\n<div class="row">\r\n  <div class="span6">\r\n    <h2>Download</h2>\r\n    <p>The source code for this application is <a href="//github.com/alessioalex/ClientManager">hosted on GitHub</a>. In addition to the client application (created using Backbone.js, RequireJS & Twitter Bootstrap), the repository includes the backend server also (built with Node.js, Express, Mongoose). Find more details in the README file of the project.</p>\r\n  </div>\r\n  <div class="span6">\r\n    <h2>Get it up & running</h2>\r\n    <p>Node.js and NPM need to be installed on your server/PC. Run "npm install ." on the command line (inside the project) to install the dependencies. Then make sure to configure the MongoDB connection details (/config/db.json) and other app settings (such as port). If you are running MongoDB with the default settings on localhost you won\'t need to change anything. When you\'re all set, run "npm start" and enjoy :)</p>\r\n    <p><a class="btn" href="#">View details &raquo;</a></p>\r\n  </div>\r\n</div>\r\n'}),define("HomeView",["text!templates/home.html"],function(tpl){var HomeView;return HomeView=Backbone.View.extend({initialize:function(){this.template=_.template(tpl)},render:function(){return $(this.el).html(this.template()),this}}),HomeView}),define("text!templates/header.html",[],function(){return'<div class="navbar navbar-fixed-top">\n  <div class="navbar-inner">\n    <div class="container">\n      <a class="brand" href="#/home">Client Manager</a>\n      <div class="nav-collapse">\n        <ul class="nav">\n          <li class="home-menu"><a href="#/home">Home</a></li>\n          <li class="list-menu"><a href="#/clients">List clients</a></li>\n          <li class="new-menu"><a href="#/clients/new">Add client</a></li>\n        </ul>\n        <img class="ajax-loader" src="img/ajax-loader.gif" alt="Loading..." />\n      </div><!--/.nav-collapse -->\n    </div>\n  </div>\n</div>\n'}),define("HeaderView",["text!templates/header.html"],function(tpl){var HeaderView;return HeaderView=Backbone.View.extend({initialize:function(){var ajaxLoader;this.template=_.template(tpl),$("body").ajaxStart(function(){ajaxLoader=ajaxLoader||$(".ajax-loader"),ajaxLoader.show()}).ajaxStop(function(){ajaxLoader.fadeOut("fast")})},render:function(){return $(this.el).html(this.template()),this},select:function(item){$(".nav li").removeClass("active"),$("."+item).addClass("active")}}),HeaderView}),define("text!templates/clients/index.html",[],function(){return'<div class="row">\r\n  <div class="span12">\r\n\r\n    <div class="page-header">\r\n      <h1>List of clients</h1>\r\n    </div>\r\n\r\n    <p>\r\n      <table class="table">\r\n        <thead>\r\n          <tr>\r\n            <th><i class="icon-user"></i>Name</th>\r\n            <th><i class="icon-envelope"></i>Email</th>\r\n            <th><i class="icon-briefcase"></i>Company</th>\r\n            <th><i class="icon-time"></i>Born</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n        <% _.each(clients, function(client) { %>\r\n          <tr>\r\n            <td>\r\n              <a href="#/clients/<%- client._id %>"><%- client.name %></a>\r\n            </td>\r\n            <td>\r\n              <a href="mailto:<%- client.email %>"><%- client.email %></a>\r\n            </td>\r\n            <td>\r\n              <%- client.company %>\r\n            </td>\r\n            <td>\r\n              <%= moment(new Date(client.born)).format("MMMM Do YYYY") %>\r\n            </td>\r\n          </tr>\r\n        <% }); %>\r\n        </tbody>\r\n      </table>\r\n    </p>\r\n\r\n  </div>\r\n</div>\r\n'}),define("ClientModel",[],function(){var Client;return Client=Backbone.Model.extend({idAttribute:"_id",urlRoot:"/api/v1/clients",defaults:{name:"",email:"",company:"",born:new Date},validate:function(attrs){var fields,i,len,nameLen,compLen,errors={};if(!attrs._silent){fields=["name","email","company","born"];for(i=0,len=fields.length;i<len;i++)attrs[fields[i]]||(errors[fields[i]]=fields[i]+" required");nameLen=attrs.name?attrs.name.length:null;if(nameLen<2||nameLen>100)errors.name="invalid name";compLen=attrs.company?attrs.company.length:null;if(!compLen||compLen<7||compLen>100)errors.company="invalid company";/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/.test(attrs.email)||(errors.email="invalid email");if(_.keys(errors).length)return{errors:errors}}}}),Client}),define("ClientCollection",["ClientModel"],function(Client){var ClientCollection;return ClientCollection=Backbone.Collection.extend({model:Client,url:"api/v1/clients"}),ClientCollection}),define("ClientListView",["text!templates/clients/index.html","ClientCollection"],function(tpl,ClientCollection){var ClientListView;return ClientListView=Backbone.View.extend({initialize:function(){var clientList;this.template=_.template(tpl),this.collection=new ClientCollection},getData:function(callback){this.collection.fetch({success:function(collection){callback(collection)},error:function(coll,res){res.status!==404&&res.status!==500}})},render:function(callback){var that=this,tmpl;this.getData(function(collection){tmpl=that.template({clients:collection.toJSON()}),$(that.el).html(tmpl),callback()})}}),ClientListView}),define("text!templates/clients/show.html",[],function(){return'<div class="row">\r\n  <div class="span6">\r\n\r\n    <div class="page-header">\r\n      <h1><%= client.name %></h1>\r\n    </div>\r\n\r\n    <p>\r\n      <table class="table table-striped">\r\n        <tbody>\r\n          <tr>\r\n            <td><h6>Name:</h6></td>\r\n            <td>\r\n              <i class="icon-user"></i>\r\n              <%= client.name %>\r\n            </td>\r\n          </tr>\r\n          <tr>\r\n            <td><h6>Email:</h6></td>\r\n            <td>\r\n              <i class="icon-envelope"></i>\r\n              <a href="mailto:<%= client.email %>"><%= client.email %></a>\r\n            </td>\r\n          </tr>\r\n          <tr>\r\n            <td><h6>Company:</h6></td>\r\n            <td>\r\n              <i class="icon-briefcase"></i>\r\n              <%= client.company %>\r\n            </td>\r\n          </tr>\r\n          <tr>\r\n            <td><h6>Born:</h6></td>\r\n            <td>\r\n              <i class="icon-time"></i>\r\n              <%= moment(new Date(client.born)).format("MMMM Do YYYY") %>\r\n            </td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n    </p>\r\n\r\n    <p>\r\n      <a href="#/clients/<%= client._id %>/edit" class="btn edit-btn">Edit</a>\r\n      <button class="btn delete-btn">Delete</button>\r\n    </p>\r\n\r\n  </div>\r\n</div>\r\n'}),define("ClientView",["text!templates/clients/show.html","ClientModel"],function(tpl,Client){var ClientView;return ClientView=Backbone.View.extend({initialize:function(){this.template=_.template(tpl)},events:{"click .delete-btn":"removeClient"},render:function(){var that=this,tmpl;return tmpl=that.template({client:this.model.toJSON()}),$(that.el).html(tmpl),this},removeClient:function(e){e.preventDefault(),this.model.destroy({sync:!0,success:function(model){model.trigger("delete-success")},error:function(model,res){res.status!==404&&res.status!==500}})}}),ClientView}),define("text!templates/clients/edit.html",[],function(){return'<div class="row">\r\n  <div class="span8">\r\n\r\n    <div class="page-header">\r\n      <h1>Edit client</h1>\r\n    </div>\r\n\r\n    <form class="form-horizontal">\r\n      <fieldset>\r\n\r\n        <div class="control-group">\r\n          <label for="name-input" class="control-label">Name</label>\r\n          <div class="controls">\r\n            <div class="input-prepend">\r\n              <span class="add-on">\r\n                <i class="icon-user"></i>\r\n              </span>\r\n              <input type="text" class="input-xlarge" id="name-input" value="<%= client.name %>" />\r\n              <p class="help-block">Enter name above, has to be between 2 and 100 chars.</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class="control-group">\r\n          <label for="email-input" class="control-label">Email</label>\r\n          <div class="controls">\r\n            <div class="input-prepend">\r\n              <span class="add-on">\r\n                <i class="icon-envelope"></i>\r\n              </span>\r\n              <input type="text" class="input-xlarge" id="email-input" value="<%= client.email %>" />\r\n              <p class="help-block">Enter a valid email above.</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class="control-group">\r\n          <label for="company-input" class="control-label">Company</label>\r\n          <div class="controls">\r\n            <div class="input-prepend">\r\n              <span class="add-on">\r\n                <i class="icon-briefcase"></i>\r\n              </span>\r\n              <input type="text" class="input-xlarge" id="company-input" value="<%= client.company %>" />\r\n              <p class="help-block">Enter company above, has to be between 7 and 100 chars.</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class="control-group">\r\n          <label for="born-input" class="control-label">Born</label>\r\n          <div class="controls">\r\n            <div class="input-prepend">\r\n              <span class="add-on">\r\n                <i class="icon-time"></i>\r\n              </span>\r\n              <input type="text" class="input-xlarge" id="born-input" value="<%= formattedDate %>" />\r\n              <p class="help-block">\r\n                Enter birth date above, using the following format: MM/DD/YYYY.<br />\r\n                Example: 01/07/1978. Client has to be above 18 years old.\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class="form-actions">\r\n          <a class="btn save-btn">Save</a>\r\n          <a class="btn back-btn">Back</a>\r\n        </div>\r\n\r\n      </fieldset>\r\n    </form>\r\n\r\n  </div>\r\n</div>\r\n'}),define("ClientEditView",["text!templates/clients/edit.html","ClientModel"],function(tpl,Client){var ClientEditView;return ClientEditView=Backbone.View.extend({initialize:function(){this.template=_.template(tpl),this.errTmpl='<div class="span4">',this.errTmpl+='<div class="alert alert-error">',this.errTmpl+='<button type="button" class="close" data-dismiss="alert">x</button>',this.errTmpl+="<%- msg %>",this.errTmpl+="</div>",this.errTmpl+="</div>",this.errTmpl=_.template(this.errTmpl)},events:{"focus .input-prepend input":"removeErrMsg","click .save-btn":"saveClient","click .back-btn":"goBack"},render:function(){var tmpl,formattedDate=" ",bornAttr;return bornAttr=this.model.get("born"),formattedDate=moment(new Date(bornAttr)).format("MM/DD/YYYY"),tmpl=this.template({client:this.model.toJSON(),formattedDate:formattedDate}),$(this.el).html(tmpl),this},goBack:function(e){e.preventDefault(),this.trigger("back")},saveClient:function(e){var name,born,email,company,that;e.preventDefault(),that=this,name=$.trim($("#name-input").val()),email=$.trim($("#email-input").val()),company=$.trim($("#company-input").val()),born=$.trim($("#born-input").val()),born?born=moment(born,"MM/DD/YYYY").valueOf():born=null,this.model.save({name:name,email:email,company:company,born:born},{silent:!1,sync:!0,success:function(model,res){res&&res.errors?that.renderErrMsg(res.errors):model.trigger("save-success",model.get("_id"))},error:function(model,res){res&&res.errors?that.renderErrMsg(res.errors):res.status!==404&&res.status!==500}})},renderErrMsg:function(err){var msgs=[];this.removeErrMsg(),_.isString(err)?msgs.push(err):(err.general&&(msgs.push(err.general),delete err.general),_.keys(err).length&&msgs.push(_.keys(err).join(", ")+" field(s) are invalid")),msgs=_.map(msgs,function(string){return string.charAt(0).toUpperCase()+string.slice(1)}).join("."),$(this.el).find("form").after(this.errTmpl({msg:msgs}))},removeErrMsg:function(){$(this.el).find(".alert-error").remove()}}),ClientEditView}),define("Router",["HomeView","HeaderView","ClientListView","ClientView","ClientEditView","ClientModel"],function(HomeView,HeaderView,ClientListView,ClientView,ClientEditView,Client){var AppRouter,initialize;return AppRouter=Backbone.Router.extend({routes:{"":"home",home:"home",clients:"showClients","clients/new":"addClient","clients/:id":"showClient","clients/:id/edit":"editClient","*actions":"defaultAction"},initialize:function(){this.clientView={},this.clientEditView={},this.headerView=new HeaderView,this.elms={"page-content":$(".page-content")},$("header").hide().html(this.headerView.render().el).fadeIn("slow"),$("footer").fadeIn("slow")},home:function(){this.headerView.select("home-menu"),this.homeView||(this.homeView=new HomeView),this.elms["page-content"].html(this.homeView.render().el)},showClients:function(){var that=this;this.headerView.select("list-menu"),this.clientListView||(this.clientListView=new ClientListView),this.clientListView.render(function(){that.elms["page-content"].html(that.clientListView.el)})},showClient:function(id){var that=this,view;this.headerView.select(),model=new Client({_id:id,_silent:!0}),model.fetch({success:function(model){model.unset("_silent"),view=new ClientView({model:model}),that.elms["page-content"].html(view.render().el),view.model.on("delete-success",function(){delete view,that.navigate("clients",{trigger:!0})})},error:function(model,res){res.status!==404&&res.status!==500}})},addClient:function(){var that=this,model,view;this.headerView.select("new-menu"),model=new Client,view=new ClientEditView({model:model}),this.elms["page-content"].html(view.render().el),view.on("back",function(){delete view,that.navigate("#/clients",{trigger:!0})}),view.model.on("save-success",function(id){delete view,that.navigate("#/clients/"+id,{trigger:!0})})},editClient:function(id){var that=this,model,view;this.headerView.select(),model=new Client({_id:id,_silent:!0}),model.fetch({success:function(model){model.unset("_silent"),view=new ClientEditView({model:model}),that.elms["page-content"].html(view.render().el),view.on("back",function(){delete view,that.navigate("#/clients/"+id,{trigger:!0})}),view.model.on("save-success",function(){delete view,that.navigate("#/clients/"+id,{trigger:!0})})},error:function(model,res){res.status!==404&&res.status!==500}})},defaultAction:function(actions){}}),AppRouter}),define("App",["Router"],function(Router){function initialize(){var app=new Router;Backbone.history.start()}return{initialize:initialize}}),requirejs.config({shim:{underscore:{exports:"_"},backbone:{deps:["underscore","jquery"],exports:"Backbone"},bootstrap:{deps:["jquery"],exports:"bootstrap"}},paths:{text:"lib/text",Mediator:"lib/mediator",App:"app",Router:"router",ClientModel:"models/client",ClientCollection:"collections/clients",HomeView:"views/home",HeaderView:"views/header",ClientListView:"views/clients/index",ClientEditView:"views/clients/edit",ClientView:"views/clients/show"}}),require(["App"],function(App){App.initialize()}),define("main",function(){})
